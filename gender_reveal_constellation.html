<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/> 
    <meta name="color-scheme" content="dark only">
    <title>Constellation Gender Reveal</title>
    <link href="main.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" type="text/css" href="main_landscape.css" media="screen and (orientation: landscape) and (max-width: 1023px)">

</head>
<body>
    <div class="stars-container" id="starsContainer"></div>
    <canvas class="constellation-canvas" id="constellationCanvas"></canvas>
    
    <div class="instructions" id="instructions">
        Click the glowing stars to reveal the secret for the Baby...
    </div>
    
    <div class="reveal-container" id="revealContainer">
        <div class="gender-text" id="genderText"></div><br>
        <div class="baby-text" id="babyText">The stars revealed the secret for the Baby!</div>
    </div>

    <script>
        // Configuration - Change these values to customize
        const CONFIG = {
            numBackgroundStars: 150
        };

        // Constellation data - complete Orion formation
        const CONSTELLATIONS = {
            orion: {
                name: 'Orion',
                gender: 'BOY',
                stars: [
                    // Main clickable stars in order
                    { name: 'Meissa', x: 0.4, y: 0.45 },          
                    { name: 'Betelgeuse', x: 0.53, y: 0.388 },      
                    { name: 'Bellatrix', x: 0.599, y: 0.479 },      
                    { name: 'Alnitak', x: 0.558, y: 0.656 },        
                    { name: 'Mintaka', x: 0.493, y: 0.701 },         
                    { name: 'Saiph', x: 0.449, y: 0.911 },           
                    { name: 'Rigel', x: 0.673, y: 0.867 }           
                ],
                additionalStars: [
                    // Revealed after main constellation
                    { name: 'Theta1 Orionis', x: 0.277, y: 0.125 },  
                    { name: 'Iota Orionis', x: 0.294, y: 0.262 },    
                    { name: 'Pi1 Orionis', x: 0.356, y: 0.388 },     
                    { name: 'Pi2 Orionis', x: 0.348, y: 0.1 },    
                    { name: 'Pi3 Orionis (Tabit)', x: 0.323, y: 0.251 }, 
                    { name: 'Pi4 Orionis', x: 0.76, y: 0.38 },     
                    { name: 'Pi5 Orionis', x: 0.78, y: 0.40 },     
                    { name: 'Pi6 Orionis', x: 0.79, y: 0.46 },      
                    { name: 'Pi6 Orionis', x: 0.76, y: 0.57 },                          
                    { name: 'Pi6 Orionis', x: 0.74, y: 0.58 },      

                ],
                extraLines: [
                    [0, 4], // main: 1-5 (Meissa-Mintaka)
                    [3, 6], // main: 4-7 (Alnitak-Rigel)
                    [2, 14],
                    [7, 8], // additional: 1-4 (Theta1 Orionis - Pi2 Orionis)
                    [8, 9], // additional: 4-5 (Pi2 Orionis - Pi3 Orionis)
                    [10, 11],   // additional: 2-3 (Iota Orionis - Pi1 Orionis)
                    [11, 8],  // additional: 3-5 (Pi1 Orionis - Pi3 Orionis)
                    [12, 13], // additional: 6-7 (Pi4 Orionis - Pi5 Orionis)
                    [13, 14], // additional: 7-8 (Pi5 Orionis - Pi6 Orionis)
                    [14, 15], // additional: 8-9 (Pi6 Orionis - Pi6 Orionis)
                    [15, 16],  // additional: 9-10 (Pi6 Orionis - Pi6 Orionis)
                    [0, 9]  // additional: 9-10 (Pi6 Orionis - Pi6 Orionis)

                ]
            },
            andromeda: {
                name: 'Andromeda',
                gender: 'GIRL', 
                stars: [
                    { name: 'Alpheratz', x: 0.6, y: 0.25 },       // Head
                    { name: 'Mirach', x: 0.65, y: 0.4 },          // Hip
                    { name: 'Almach', x: 0.7, y: 0.55 },          // Left foot
                    { name: 'Delta And', x: 0.55, y: 0.45 },      // Right side
                    { name: 'Mu And', x: 0.5, y: 0.35 },          // Right arm
                    { name: 'Nu And', x: 0.75, y: 0.35 },         // Left arm
                    { name: 'Upsilon And', x: 0.68, y: 0.7 }      // Right foot
                ]
            }
        };
        // Global variables for params and surname
        let timeout;
        var color1 = '#ff95c8';
        var color2 = '#0128A5FF';
        var color3 ='#969696';
        var colortxt1 = '#ff0b9a';
        var colortxt2= '#88BEFFFF';
        var colortxt3= '#000000';
        //Select the background color
        var color =color2;
        //Select the text color
        var colortxt = colortxt2;
        var gendertext1 = "It is a Girl!";
        var gendertext2 = "It is a Boy!";
        var gendertext3= "It is a Demo!";
        //Select the gender text
        var gendertext = gendertext2;
        var soundHandle = new Audio();
        var triggered=false;
        var nosound=true;
        let params = new URLSearchParams(window.location.search.slice(1));
        let surname = params.get('surname');
        // Set constellation based on gendertext
        if (gendertext.toLowerCase().includes('boy')) {
            CONFIG.constellation = 'orion';
        } else if (gendertext.toLowerCase().includes('girl')) {
            CONFIG.constellation = 'andromeda';
        }
        class ConstellationReveal {
            constructor() {
                this.canvas = document.getElementById('constellationCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.starsContainer = document.getElementById('starsContainer');
                this.instructions = document.getElementById('instructions');
                this.revealContainer = document.getElementById('revealContainer');
                
                this.currentConstellation = CONSTELLATIONS[CONFIG.constellation];
                this.currentStarIndex = 0;
                this.constellationStars = [];
                this.lines = [];
                this.isRevealed = false;
                
                this.init();
            }

            drawExtraLines() {
                const { extraLines } = this.currentConstellation;
                if (!extraLines) return;
                const allStars = [...this.constellationStars, ...(this.additionalStars || [])];
                extraLines.forEach(([fromIdx, toIdx]) => {
                    this.drawLine(allStars[fromIdx], allStars[toIdx]);
                });
            }

            revealAdditionalStars() {
                if (this.additionalStars) {
                    this.additionalStars.forEach((star, index) => {
                        setTimeout(() => {
                            star.style.visibility = 'visible';
                            star.style.opacity = '0.7';
                            star.classList.add('additional');
                            // Draw extra lines after all additional stars are visible
                            if (index === this.additionalStars.length - 1) {
                                setTimeout(() => {
                                    this.drawExtraLines();
                                    // Show the PNG overlay below the stars
                                    this.showOrionOverlay(false);
                                }, 300);
                            }
                        }, index * 200);
                    });
                }
            }

            showOrionOverlay(updateOnly = false) {
                let img = document.getElementById('orion-overlay-img');
                const canvasRect = this.canvas.getBoundingClientRect();
                if (img && updateOnly) {
                    img.style.left = canvasRect.left + 'px';
                    img.style.top = canvasRect.top + 'px';
                    img.style.width = canvasRect.width + 'px';
                    img.style.height = canvasRect.height + 'px';
                    return;
                }
                if (img) img.remove();
                img = document.createElement('img');
                img.src = 'stars_orion.png';
                img.id = 'orion-overlay-img';
                img.style.position = 'absolute';
                img.style.left = canvasRect.left + 'px';
                img.style.top = canvasRect.top + 'px';
                img.style.width = canvasRect.width + 'px';
                img.style.height = canvasRect.height + 'px';
                img.style.zIndex = 8; // below stars (z-index:10)
                img.style.pointerEvents = 'none';
                img.style.opacity = '0'; // Start fully transparent
                img.style.transition = 'opacity 1.5s ease'; // Animate fade-in
                document.body.insertBefore(img, this.starsContainer);
                setTimeout(() => { img.style.opacity = '0.5'; }, 50);
            }
           
            init() {
                this.handleResizeOrOrientationChange();
                // Update instructions with family name or fallback
                if (surname === null || surname.replace(/\s/g, '').length === 0) {
                    surname= 'the Baby';
                } else{
                    surname = 'the Baby ' + surname;
                }
                this.instructions.textContent = 'Click the glowing star to reveal the secret for ' + surname + '...';
                // Show first star
                window.addEventListener('resize', () => this.handleResizeOrOrientationChange());
                window.addEventListener('orientationchange', () => this.handleResizeOrOrientationChange());
            }

            handleResizeOrOrientationChange() {
               clearTimeout(timeout);
                timeout = setTimeout(() => {
                        this.setupCanvas();
                        this.createBackgroundStars();
                        this.createConstellationStars();
                        this.highlightCurrentStar();
                    }, 200);
                 
            }

            setupCanvas() {
                // Make canvas square, width and height = min(window.innerWidth, window.innerHeight)
                const size = Math.min(window.innerWidth, window.innerHeight);
                this.canvas.width = size;
                this.canvas.height = size;
                this.canvas.style.width = size + 'px';
                this.canvas.style.height = size + 'px';
                this.canvas.style.position = 'absolute';
                // If portrait, move canvas 20% down
                /* if (window.innerHeight > window.innerWidth) {
                    this.canvas.style.top = (window.innerHeight * 0.2) + 'px';
                    this.canvas.style.left = ((window.innerWidth - size) / 2) + 'px';
                }  */
                // Make starsContainer full screen for background
                this.starsContainer.style.width = '100vw';
                this.starsContainer.style.height = '100vh';
                this.starsContainer.style.position = 'absolute';
                this.starsContainer.style.left = '0';
                this.starsContainer.style.top = '0';
               
            }

            createBackgroundStars() {
                // Remove previous background stars if resizing
                const existingStars = this.starsContainer.querySelectorAll('.background-star');
                existingStars.forEach(star => star.remove());
                for (let i = 0; i < CONFIG.numBackgroundStars; i++) {
                    const star = document.createElement('div');
                    star.className = 'star background-star';
                    star.style.left = Math.random() * 100 + '%';
                    star.style.top = Math.random() * 100 + '%';
                    star.style.animationDelay = Math.random() * 2 + 's';
                    star.style.animationDuration = (1 + Math.random() * 2) + 's';
                    this.starsContainer.appendChild(star);
                }
            }

            createConstellationStars() {
                const margin = 0.00;
                // Get canvas offset for correct placement
                const canvasRect = this.canvas.getBoundingClientRect();
                const leftOffset = canvasRect.left;
                const topOffset = canvasRect.top;
                // Additional stars
                if (this.currentConstellation.additionalStars) {
                    if (this.additionalStars && this.additionalStars.length === this.currentConstellation.additionalStars.length) {
                        this.currentConstellation.additionalStars.forEach((starData, index) => {
                            const star = this.additionalStars[index];
                            if (star) {
                                star.style.left = ((margin + starData.x * (1 - 2 * margin)) * this.canvas.width + leftOffset) + 'px';
                                star.style.top = ((margin + starData.y * (1 - 2 * margin)) * this.canvas.height + topOffset) + 'px';
                            }
                        });
                    } else {
                        if (this.additionalStars) {
                            this.additionalStars.forEach(star => star.remove());
                        }
                        this.additionalStars = [];
                        this.currentConstellation.additionalStars.forEach((starData, index) => {
                            const star = document.createElement('div');
                            star.className = 'star constellation-star additional';
                            star.style.left = ((margin + starData.x * (1 - 2 * margin)) * this.canvas.width + leftOffset) + 'px';
                            star.style.top = ((margin + starData.y * (1 - 2 * margin)) * this.canvas.height + topOffset) + 'px';
                            star.style.visibility = 'hidden';
                            star.style.opacity = '0';
                            this.starsContainer.appendChild(star);
                            this.additionalStars.push(star);
                        });
                    }
                }
                // Reposition and redraw existing constellation stars
                if (this.constellationStars.length === this.currentConstellation.stars.length) {
                    // Only update position and visibility
                    this.currentConstellation.stars.forEach((starData, index) => {
                        const star = this.constellationStars[index];
                        if (star) {
                            star.style.left = ((margin + starData.x * (1 - 2 * margin)) * this.canvas.width + leftOffset) + 'px';
                            star.style.top = ((margin + starData.y * (1 - 2 * margin)) * this.canvas.height + topOffset) + 'px';
                        }
                    });
                    // Redraw lines between completed stars
                    this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                    setTimeout(() =>{
                        for (let i = 1; i < this.constellationStars.length; i++) {
                            if (this.constellationStars[i].classList.contains('completed')) {
                                this.drawLine(this.constellationStars[i - 1], this.constellationStars[i]);
                            }
                        }
                        if (this.isRevealed) {
                            this.drawExtraLines();
                            this.showOrionOverlay(true);
                        }
                    },500);

                } else {
                    // Initial creation
                    this.constellationStars.forEach(star => star.remove());
                    this.constellationStars = [];
                    this.currentConstellation.stars.forEach((starData, index) => {
                        const star = document.createElement('div');
                        star.className = 'star constellation-star';
                        star.style.left = ((margin + starData.x * (1 - 2 * margin)) * this.canvas.width + leftOffset) + 'px';
                        star.style.top = ((margin + starData.y * (1 - 2 * margin)) * this.canvas.height + topOffset) + 'px';
                        star.style.visibility = 'hidden';
                        star.style.opacity = '0';
                        star.dataset.index = index;
                        const touchHint = document.createElement('div');
                        touchHint.className = 'touch-hint';
                        touchHint.textContent = 'Touch here';
                        star.appendChild(touchHint);
                        star.addEventListener('click', (e) => this.handleStarClick(e, index));
                        this.starsContainer.appendChild(star);
                        this.constellationStars.push(star);
                    });
                     
                }
               
               
            }

            highlightCurrentStar() {
                if (this.currentStarIndex < this.constellationStars.length) {
                    // Clear all current highlights and hints first
                    this.constellationStars.forEach(star => {
                        star.classList.remove('current');
                        const hint = star.querySelector('.touch-hint');
                        if (hint) hint.classList.remove('show');
                    });
                    
                    // Clear any existing hint timer
                    if (this.hintTimer) {
                        clearTimeout(this.hintTimer);
                    }
                    
                    // Show and highlight current star
                    const currentStar = this.constellationStars[this.currentStarIndex];
                    currentStar.style.visibility = 'visible';
                    currentStar.style.opacity = '1';
                    currentStar.classList.add('current');
                    
                    // Set timer for touch hint (random between 3-5 seconds)
                    const hintDelay = 3000 + Math.random() * 2000; // 3-5 seconds
                    this.hintTimer = setTimeout(() => {
                        const hint = currentStar.querySelector('.touch-hint');
                        if (hint && currentStar.classList.contains('current')) {
                            hint.classList.add('show');
                        }
                    }, hintDelay);
                    
                }
            }

            handleStarClick(event, clickedIndex) {
                
                if (this.isRevealed || clickedIndex !== this.currentStarIndex) {
                    return;
                }
                
                // Clear hint timer
                if (this.hintTimer) {
                    clearTimeout(this.hintTimer);
                }
                
                const star = this.constellationStars[clickedIndex];
                
                // Hide touch hint
                const hint = star.querySelector('.touch-hint');
                if (hint) {
                    hint.classList.remove('show');
                    hint.style.display = 'none';
                }
                
                // Mark star as completed
                star.classList.remove('current');
                star.classList.add('completed');
                star.style.visibility = 'visible';
                star.style.opacity = '1';
                
                // Draw line to previous star
                if (this.currentStarIndex > 0) {
                    this.drawLine(
                        this.constellationStars[this.currentStarIndex - 1],
                        star
                    );
                }
                
                this.currentStarIndex++;
                
                // Hide instructions after first click
                if (this.currentStarIndex === 1) {
                    this.instructions.classList.add('hidden');
                }
                
                // Check if main constellation is complete
                if (this.currentStarIndex >= this.constellationStars.length) {
                    this.revealAdditionalStars();
                    setTimeout(() => {
                        this.completeReveal();
                    }, 1000);
                } else {
                    // Show next star
                    setTimeout(() => {
                        this.highlightCurrentStar();
                    }, 100);
                }
            }

            drawLine(fromStar, toStar) {
                // Draw lines using the DOM position of the stars, relative to the canvas
                const canvasRect = this.canvas.getBoundingClientRect();
                const fromRect = fromStar.getBoundingClientRect();
                const toRect = toStar.getBoundingClientRect();
                const fromX = (fromRect.left - canvasRect.left) + fromRect.width / 2;
                const fromY = (fromRect.top - canvasRect.top) + fromRect.height / 2;
                const toX = (toRect.left - canvasRect.left) + toRect.width / 2;
                const toY = (toRect.top - canvasRect.top) + toRect.height / 2;
                this.ctx.strokeStyle = '#FFD700';
                this.ctx.lineWidth = 3;
                this.ctx.shadowColor = '#FFD700';
                this.ctx.shadowBlur = 15;
                this.ctx.beginPath();
                this.ctx.moveTo(fromX, fromY);
                this.ctx.lineTo(toX, toY);
                this.ctx.stroke();
            }

            completeReveal() {
                this.isRevealed = true;
                // Create shooting stars animation
                this.createShootingStars();
                // Show reveal message after short delay
                setTimeout(() => {
                    const genderText = document.getElementById('genderText');
                    genderText.textContent = gendertext;
                    genderText.classList.add('animate');
                    // Set solid color for genderText using color variable
                    genderText.style.background = '';
                    genderText.style.backgroundClip = '';
                    genderText.style.webkitBackgroundClip = '';
                    genderText.style.webkitTextFillColor = '';
                    genderText.style.textFillColor = '';
                    genderText.style.color = colortxt;
                    this.revealContainer.classList.add('show');
                    // Set babyText with surname if set, otherwise fallback
                    const babyText = document.getElementById('babyText');                    
                   
                    if (gendertext==gendertext2){
                        babyText.textContent= surname + ' will be Strong and bold — just like Orion, the great hunter in the sky';
                    }else {
                        babyText.textContent=surname + ' will be Graceful and radiant — like Andromeda, the princess of the stars';

                    }

                }, 1000);
            }

            createShootingStars() {
                let w=window.innerWidth;
                let h=window.innerHeight;
                for (let i = 0; i < 50; i++) {
                    setTimeout(() => {
                        const shootingStar = document.createElement('div');
                        shootingStar.className = 'shooting-star';
                        
                        // Random starting positions from different edges
                        let side = Math.floor(Math.random() * 4);
                        side = 2;
                        let startX, startY, endX, endY;
                        switch(side) {
                            case 0: // Top edge
                                startX = 0;
                                startY = -10;
                                endX =  w;
                                endY = h;
                                break;
                            case 1: // Right edge  
                                startX = w+10;
                                startY = Math.random() * h;
                                endX = -10;
                                endY = h+10;
                                break;
                            case 2: // Bottom edge
                                startX = Math.random() * w;
                                startY = h+10;
                                endX = w+10;
                                endY = Math.random() * h;
                                break;
                            case 3: // Left edge
                                startX = -10;
                                startY = Math.random() * 100;
                                endX = 110;
                                endY = Math.random() * 100;
                                break;
                        }
                        
                        shootingStar.style.left = startX + '%';
                        shootingStar.style.top = startY + '%';
                        shootingStar.style.setProperty('--endX', endX + '%');
                        shootingStar.style.setProperty('--endY', endY + '%');
                        
                        shootingStar.style.animation = `shootingStar${side} 0.5s linear forwards`;
                        shootingStar.style.boxShadow = '0 0 15px white, 0 0 30px white';
                        shootingStar.style.width = '5px';
                        shootingStar.style.height = '5px';
                        
                        this.starsContainer.appendChild(shootingStar);
                        
                        setTimeout(() => {
                            shootingStar.remove();
                        }, 10000);
                    }, i * 50);
                }
            }
        }

        // Initialize the reveal when page loads
        document.addEventListener('DOMContentLoaded', () => {
            new ConstellationReveal();
        });

    </script>
</body>
</html>